define("trajectory/atom",["./util/emitter"],function(a,b,c){function d(a){this._init(a)}var e=a("./util/emitter");e(d.prototype),d.prototype._init=function(a){this.option=a,this._attr={},this._attr.x=a.x||0,this._attr.y=a.y||0,this._attr.destination=a.destination||{x:this.get("x"),y:this.get("y")},this._attr.vel=a.vel||1,this._attr.rgba=a.rgba||"rgba(0,0,0,255)",this._attr.radius=a.radius||1,this.on("destinationAlter",function(){this.rest=!1})},d.prototype.get=function(a){return this._attr[a]},d.prototype.set=function(a,b){this._attr[a]=b,this.emit(a+"Alter")},d.prototype.move=function(){if(!this.rest){var a,b,c,d=this.get("x"),e=this.get("y"),f=this.get("destination"),g=f.x-d,h=f.y-e,i=this.get("vel");if(a=Math.sqrt(Math.pow(Math.abs(g),2)+Math.pow(Math.abs(h),2)),0===a)return void(this.rest=!0);b=g*i/a,c=h*i/a,Math.abs(b)>=Math.abs(g)?this._attr.x=f.x:this._attr.x+=b,Math.abs(c)>=Math.abs(h)?this._attr.y=f.y:this._attr.y+=c}},d.prototype.moveTo=function(a,b){isNaN(a)||this.set("x",a),isNaN(b)||this.set("y",b)},c.exports=d}),define("trajectory/util/emitter",[],function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}c.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}}),define("trajectory/circle",["./util/emitter","./util/renderer","./util/cpi","./atom"],function(a,b,c){function d(a){this.atoms=[],a=a||{},this.center={x:a.x||10,y:a.y||10},this.vel=a.vel||.01}var e=a("./util/emitter"),f=a("./util/renderer"),g=a("./atom");e(d.prototype),f(d.prototype),d.prototype.addAtom=function(a){function b(a,b){a instanceof g||!a.x||!a.y||(a=new g(a)),b.atoms.push(a),a.radius=Math.sqrt(Math.pow(Math.abs(b.center.x-a.get("x")),2)+Math.pow(Math.abs(b.center.y-a.get("y")),2)),0===a.radius?a.radian=0:a.get("x")>b.center.x&&a.get("y")<=b.center.y?a.radian=Math.asin((b.center.y-a.get("y"))/a.radius):a.get("x")<=b.center.x&&a.get("y")<b.center.y?a.radian=Math.PI-Math.asin((b.center.y-a.get("y"))/a.radius):a.get("x")<b.center.x&&a.get("y")>=b.center.y?a.radian=Math.asin((a.get("y")-b.center.y)/a.radius)+Math.PI:a.get("x")>=b.center.x&&a.get("y")>b.center.y&&(a.radian=-Math.asin((a.get("y")-b.center.y)/a.radius))}if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c],this);else b(a,this)},d.prototype.next=function(){for(var a=0;a<this.atoms.length;a++){var b=this.atoms[a],c=Math.sqrt(Math.pow(Math.abs(this.center.x-b.get("x")),2)+Math.pow(Math.abs(this.center.y-b.get("y")),2));b.radian=b.radian+this.vel,b.radian>2*Math.PI&&(b.radian=b.radian-2*Math.PI),b.set("x",Math.cos(b.radian)*c+this.center.x),b.set("y",-Math.sin(b.radian)*c+this.center.y)}},c.exports=d}),define("trajectory/util/renderer",["trajectory/util/cpi"],function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}var f=a("trajectory/util/cpi");d.prototype.renderTo=function(a){var b=a.getContext("2d");if(this.atoms)for(var c=0;c<this.atoms.length;c++){var d=this.atoms[c];f.drawSolidCircle(b,d.get("x"),d.get("y"),d.get("radius"),d.get("rgba"))}},c.exports=d}),define("trajectory/util/cpi",[],function(a,b,c){function d(){return e(window.innerWidth,window.innerHeight-5)}function e(a,b){var c=document.createElement("canvas");return c.style.margin=c.style.padding=c.style.border=0,c.width=a,c.height=b,document.body.style.margin=document.body.style.padding=document.body.style.border=0,document.body.style.textAlign="center",document.body.appendChild(c),c}function f(a,b,c,d){a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.stroke()}function g(a,b,c,d,e){a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.fillStyle=e,a.fill()}function h(a,b,c,d,e,f,g){var h=a.getImageData(b,c,1,1);h.data[0]=d||0,h.data[1]=e||0,h.data[2]=f||0,h.data[3]=g||255,a.putImageData(h,b,c)}b.createCanvasFullScreen=d,b.createCanvas=e,b.drawHollowCircle=f,b.drawSolidCircle=g,b.pixelSetDark=h}),define("trajectory/line",["./util/emitter","./util/renderer","./util/cpi","./atom","./util/random"],function(a,b,c){function d(a){this.atoms=[],a=a||{},this.vel=a.vel||1}var e=a("./util/emitter"),f=a("./util/renderer"),g=a("./atom"),h=a("./util/random");e(d.prototype),f(d.prototype),d.prototype.addAtom=function(a){function b(a,b){a instanceof g||!a.x||!a.y||(a=new g(a)),a.set("vel",b.vel),b.atoms.push(a)}if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c],this);else b(a,this)},d.prototype.next=function(){for(var a,b=0,c=!0;b<this.atoms.length;b++)a=this.atoms[b],a.rest||(a.move(),c=!1);c&&this.emit("rest")},d.prototype.random=function(a,b,c,d){a=a||0,b=b||0,c=c||100,d=d||100;for(var e=0;e<this.atoms.length;e++)this.atoms[e].set("x",h(a,c)),this.atoms[e].set("y",h(b,d))},d.prototype.randomDestination=function(a,b,c,d){a=a||0,b=b||0,c=c||100,d=d||100;for(var e=0;e<this.atoms.length;e++)this.atoms[e].set("destination",{x:h(0,c),y:h(0,d)})},d.prototype.setVel=function(a){if(!isNaN(a))for(var b=0;b<this.atoms.length;b++)this.atoms[b].set("vel",a)},d.prototype.setDestinations=function(a){if(a instanceof Array){for(var b=0;b<this.atoms.length&&void 0!==a[b];b++)this.atoms[b].set("destination",a[b]);if(b<this.atoms.length-1)this.atoms.splice(b);else for(;b<a.length;b++)this.atoms.push(new g(a[b]))}},c.exports=d}),define("trajectory/util/random",[],function(a,b,c){function d(a,b){return Math.floor(Math.random()*(b-a))+a}c.exports=d}),define("trajectory/shape",["./util/emitter","./util/renderer","./util/cpi","./atom","./util/random"],function(a,b,c){function d(a){a=a||{}}a("./util/emitter"),a("./util/renderer"),a("./atom"),a("./util/random");c.exports=d}),define("trajectory/util/image2atom",["./cpi","./random","lib/jquery"],function(a,b,c){function d(){var a={};return a.rate=n("#configPanl .rate").val(),a.disorder=n("#configPanl .disorder").get(0).checked,a.colorful=n("#configPanl .colorful").get(0).checked,a.rmin=n("#configPanl .rmin").val(),a.gmin=n("#configPanl .gmin").val(),a.bmin=n("#configPanl .bmin").val(),a.amin=n("#configPanl .amin").val(),a.rmax=n("#configPanl .rmax").val(),a.gmax=n("#configPanl .gmax").val(),a.bmax=n("#configPanl .bmax").val(),a.amax=n("#configPanl .amax").val(),a}function e(a){for(var b=a.data,c=[],e=a.width,f=d(),g=0;g<b.length;g+=4){var h,i,j;b.length/4;h=g/4%e,i=Math.floor(g/4/e),j="rgba("+b[g]+","+b[g+1]+","+b[g+2]+","+b[g+3]+")",f.rmin<=b[g]&&b[g]<=f.rmax&&f.gmin<=b[g+1]&&b[g+1]<=f.gmax&&f.bmin<=b[g+2]&&b[g+2]<=f.bmax&&f.amin<=b[g+3]&&b[g+3]<=f.amax&&c.push({x:h,y:i,rgba:j})}return c}function f(a,b){var c,d,e=[],f=i=0;for(b=Math.abs(1>b?b:b/100),c=Math.floor(1/b),console.log(c,b);i+f<a.length;i+=d)f=m(1,c),a[i+f]&&e.push(a[i+f]),d=2*c-f;return console.log(e.length),e}function g(a){q.src=a}var h,j,k,l=a("./cpi"),m=a("./random"),n=a("lib/jquery"),o=l.createCanvasFullScreen(),p=o.getContext("2d"),q=new Image;q.onload=function(){p.drawImage(q,0,0),h=p.getImageData(0,0,q.width,q.height),j=e(h)},function(){var a='<div style=""><span style="display:block">抽取率</span><input type="range" min=1 max=100 class="item rate" /></div><div style=""><span style="display:block">打乱顺序</span><input type="checkbox" class="item disorder" /></div><div style=""><span style="display:block">渲染颜色</span><input type="checkbox" class="item colorful" /></div><div style=""><span style="display:block">颜色过滤</span><div style="margin-top:3px"><input type="text" value="0" style="width:25px" class="item rmin" />&lt;=R&lt;=<input type="text" value="255" style="width:25px" class="item rmax" /></div><div style="margin-top:3px"><input type="text" value="0" style="width:25px" class="item gmin" />&lt;=G&lt;=<input type="text" value="255" style="width:25px" class="item gmax" /></div><div style="margin-top:3px"><input type="text" value="0" style="width:25px" class="item bmin" />&lt;=B&lt;=<input type="text" value="255" style="width:25px" class="item bmax" /></div><div style="margin-top:3px"><input type="text" value="0" style="width:25px" class="item amin" />&lt;=A&lt;=<input type="text" value="255" style="width:25px" class="item amax" /></div></div><div style="margin-top:10px"><button id="executeBtn">执行</button></div>',b=document.createElement("div"),c=document.createElement("div");b.id="configPanl",c.id="panlMask",b.style.cssText="position: fixed; z-index:300; right:0; top:0; margin:50px; font-size:12px",c.style.cssText="position: fixed; z-index:301; right:0; top:0; width:300px; height:0px; padding-top:300px; background-color:gray; opacity:0.5; display:none",c.innerHTML="loading...",b.innerHTML=a,document.body.appendChild(c),document.body.appendChild(b)}(),n("#configPanl #executeBtn").on("click",function(){n("#panlMask").show();var a=d();j=e(h),console.log(a),k=f(j,a.rate),p.clearRect(0,0,o.width,o.height);for(var b=0;b<k.length;b++)l.drawSolidCircle(p,k[b].x,k[b].y,1,a.colorful?k[b].rgba:"gray");n("#panlMask").hide()}),b.setImgSrc=g,b.getAtoms=function(){return k}}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),define("trajectory/util/looper",[],function(a,b,c){function d(){if(!i){var a,b,c=(new Date).getTime();for(b in j)if(j.hasOwnProperty(b)){var e=j[b];if(e.lastest+parseInt(b)<=c){for(a=0;a<e.events.length;a++)e.events[a]();e.lastest=c}}window.requestAnimationFrame(d)}}function e(a,b){if(void 0==b&&(b=a,a=0),!k.test(a))throw new Error("时间间隔应为整数");if(void 0==j[a]&&(j[a]={lastest:(new Date).getTime(),events:[]}),b instanceof Function&&j[a].events.push(b),b instanceof Array)for(var c=0;c<b.length;c++)j[a].events.push(b[c])}function f(a){var b,c,d;for(c in j)if(j.hasOwnProperty(c))for(d=j[c].events,b=0;b<d.length;b++)d[b]===a&&d.splice(b,1)}function g(){i=!0}function h(){i=!1,d()}var i=!1,j={},k=/^[0-9]*$/;window.timerEvents=j,b.run=h,b.add=e,b.remove=f,b.stop=g});